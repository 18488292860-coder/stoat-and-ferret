# v005 Validation Details

## 1. Content Completeness Check

### Draft vs Persisted Document Comparison

Compared all 28 draft documents from `comms/outbox/exploration/design-v005-007-drafts/drafts/` against persisted versions in `comms/inbox/versions/execution/v005/`.

**VERSION_DESIGN.md** -- MISMATCH (expected)
- The persisted version was generated by the `design_version` MCP tool using its template format
- Draft contains: Key Technical Decisions table (6 decisions), Execution Order diagram, Risks table (6 risks), Dependencies section, References section
- Persisted contains: Linked backlog items, Design Context section, Themes table, Success Criteria checklist
- Assessment: Template-generated format is structurally different but the essential information (backlog items, theme listing, context) is present. The detailed content from the draft exists in THEME_DESIGN.md files and feature documents.

**THEME_INDEX.md** -- MISMATCH (expected)
- Persisted version uses placeholder `_Feature description_` for all 11 features instead of draft's specific descriptions
- Persisted adds useful structural info: execution paths, execution order instructions, notes section
- Assessment: Feature descriptions are available in each feature's requirements.md. The placeholder text is cosmetic.

**4 THEME_DESIGN.md files** -- All MATCH
- Theme 01 (frontend-foundation): Identical content
- Theme 02 (backend-services): Identical content
- Theme 03 (gui-components): Identical content
- Theme 04 (e2e-testing): Identical content
- Only difference: drafts have trailing newline, persisted versions don't (cosmetic)

**11 requirements.md files** -- All MATCH
- All 11 feature requirements.md files are identical between draft and persisted versions
- No truncation detected in any file
- Only difference: trailing newline (cosmetic)

**11 implementation-plan.md files** -- All MATCH
- All 11 feature implementation-plan.md files are identical between draft and persisted versions
- No truncation detected in any file (largest is 115 lines)
- Only difference: trailing newline (cosmetic)

### Summary
- 26/28 documents: Content identical (trailing newline only)
- 2/28 documents: Template-generated (VERSION_DESIGN.md, THEME_INDEX.md) with different format but equivalent information

---

## 2. Reference Resolution

Searched all execution documents for references to `comms/outbox/versions/design/v005/`.

**Pattern 1:** `comms/outbox/versions/design/v005/004-research/` (directory)
- Found in: All 11 requirements.md files
- Resolution: Directory exists with 5 files (README.md, codebase-patterns.md, external-research.md, evidence-log.md, impact-analysis.md)
- Status: VALID

**Pattern 2:** `comms/outbox/versions/design/v005/006-critical-thinking/risk-assessment.md` (file)
- Found in: All 4 THEME_DESIGN.md + all 11 implementation-plan.md (15 files total)
- Resolution: File exists on disk
- Status: VALID

Total: 26 references checked, 0 broken.

---

## 3. Notes Propagation

### Design Research Source Documents
- `005-logical-design/risks-and-unknowns.md`: 6 risks (R-1 through R-6), 4 unknowns (UQ-1 through UQ-4)
- `006-critical-thinking/risk-assessment.md`: Investigated resolutions for all 10 items
- `002-backlog/backlog-details.md`: 10 backlog items with notes

### Propagation Results

| Item | Description | Propagated? | Location in Execution Docs |
|------|-------------|-------------|---------------------------|
| R-1 | Framework selection (High) | Yes | Theme 01 THEME_DESIGN.md, Feature 001 requirements.md |
| R-2 | SPA routing edge cases (Medium) | Yes | Theme 01 THEME_DESIGN.md, Feature 001 impl-plan Risks |
| R-3 | WebSocket stability (Medium) | Yes | Theme 01 & 03 THEME_DESIGN.md, Features 002 & T03-001 |
| R-4 | Thumbnail performance (Medium) | Yes | Theme 02 THEME_DESIGN.md, Feature 001 impl-plan Risks |
| R-5 | CI build time (Low) | Yes | Features 001 & T04-001 impl-plans, distributed across relevant features |
| R-6 | Virtual scrolling compat (Low) | Yes | Theme 03 THEME_DESIGN.md, Feature 003 impl-plan |
| UQ-1 | WS heartbeat interval (Low) | Yes | Feature 003 & 002 requirements.md |
| UQ-2 | Virtual scrolling library (Medium) | Yes | Combined with R-6 in Feature 003 |
| UQ-3 | Thumbnail timing (Low) | Yes | Feature T02-001 requirements.md Out of Scope |
| UQ-4 | Frontend test coverage (Low) | Yes | Theme 04 THEME_DESIGN.md Risks table |

**Minor detail losses (non-actionable):**
- R-4: BL-032 AC#1 explicit flexibility not cited in execution docs (context preserved indirectly)
- R-4: `AsyncioJobQueue` class name not mentioned (essential insight about async preserved)
- UQ-4: "Ratchet up in v006+" forward planning note not carried (future-version planning note)

---

## 4. validate_version_design Tool

```
Result: SUCCESS
  valid: true
  themes_validated: 4
  features_validated: 11
  documents_found: 30
  documents_missing: 0
  consistency_errors: 0
```

---

## 5. Backlog Alignment

### Mandatory Backlog Items: 10

| Backlog Item | Mapped Feature(s) | Status |
|--------------|--------------------|--------|
| BL-003 | 01/001-frontend-scaffolding, 01/003-settings-and-docs | COVERED |
| BL-028 | 01/001-frontend-scaffolding | COVERED |
| BL-029 | 01/002-websocket-endpoint, 01/003-settings-and-docs | COVERED |
| BL-030 | 03/001-application-shell | COVERED |
| BL-031 | 03/002-dashboard-panel | COVERED |
| BL-032 | 02/001-thumbnail-pipeline | COVERED |
| BL-033 | 03/003-library-browser | COVERED |
| BL-034 | 02/002-pagination-total-count | COVERED |
| BL-035 | 03/004-project-manager | COVERED |
| BL-036 | 04/001-playwright-setup, 04/002-e2e-test-suite | COVERED |

All acceptance criteria verified as aligned between backlog items and feature requirements.

---

## 6. File Paths Exist

### Files to Modify -- Verification

Most referenced source files exist on disk. Issues found:

| Severity | Location | Issue |
|----------|----------|-------|
| Warning | T02/002 impl-plan | References `src/stoat_ferret/db/async_sqlite_repository.py` and `async_inmemory_repository.py` -- both classes are actually in `async_repository.py` |
| Warning | T02/002 impl-plan | References `tests/test_repository.py` and `tests/test_videos_router.py` -- actual files are `test_async_repository_contract.py` / `test_repository_contract.py` |
| Minor | T01/003 impl-plan | `tests/test_settings.py` marked "Modify" but doesn't exist (should be "Create") |
| Minor | T02/001 impl-plan | `static/` parent directory doesn't exist for `placeholder-thumb.jpg` |
| Cosmetic | T01/001 impl-plan | `gui/vite.config.ts` and `gui/src/index.css` marked "Modify" but are scaffolded-then-modified |

### Files to Create -- Verification

All `gui/**` paths are for the greenfield frontend. The `gui/` directory doesn't exist yet (created by T01/001). All subsequent themes correctly depend on Theme 01 completing first.

---

## 7. Dependency Accuracy

### Theme-Level Dependencies

```
Theme 01 (frontend-foundation) -> Theme 02 (backend-services) -> Theme 03 (gui-components) -> Theme 04 (e2e-testing)
```

Linear chain, no circular dependencies. All declared dependencies verified as correct.

### Feature-Level Dependencies

**Theme 01:** 001 -> 002 -> 003 (linear)
**Theme 02:** 001 (depends on T01-003), 002 (independent)
**Theme 03:** 001 (depends on T01), 002 (depends on T03-001), 003 (depends on T03-001 + T02), 004 (depends on T03-001)
**Theme 04:** 001 (depends on T03 complete), 002 (depends on T04-001)

No circular dependencies. All cross-theme dependencies correctly identify the required predecessor themes/features.

---

## 8. Mitigation Strategy

No workarounds are needed for execution. The file path issues in Task 6 are self-correcting:

- **Wrong repository file names (T02/002):** The implementing agent will search for the class names (`AsyncSQLiteVideoRepository`, `AsyncInMemoryVideoRepository`) and find them in `async_repository.py`. The class names and modification intent are clear.
- **Missing test files (T02/002):** The agent will search for related test files and find them. Contract test patterns are documented.
- **`tests/test_settings.py` (T01/003):** The agent will create this file since it doesn't exist. The plan's content describes what to write.
- **`static/` directory (T02/001):** The agent will create the directory as part of creating the placeholder file.

---

## 9. Design Docs Committed

Git status check:
- Branch: `main` (tracking `origin/main`, up to date)
- Only modified file: `comms/state/explorations/design-v005-009-validation-1770635736275.json` (this exploration's state file)
- No uncommitted changes in `comms/inbox/versions/execution/v005/`
- No uncommitted changes in `comms/outbox/versions/design/v005/`

All design documents are committed.

---

## 10. Handover Document

`STARTER_PROMPT.md` exists and includes:
- Instructions to read AGENTS.md first
- Process steps: read THEME_INDEX.md, iterate themes/features, create outputs
- Status tracking: update STATUS.md after each feature
- Output document requirements: completion-report.md, quality-gaps.md, handoff-to-next.md
- Quality gates: ruff check, ruff format, mypy, pytest commands

The document is complete and provides sufficient context for autonomous execution.

---

## 11. Impact Analysis Completeness

### Dependencies
All VERSION_DESIGN.md and THEME_DESIGN.md documents identify dependencies clearly:
- VERSION_DESIGN.md: 6 constraints documenting sequencing requirements
- Each THEME_DESIGN.md: Inbound/outbound dependencies listed

### Breaking Changes
- Theme 02 Feature 002 adds `count()` to `AsyncVideoRepository` protocol -- this is a protocol-level change affecting both in-tree implementations. The design correctly lists both implementations but doesn't explicitly flag this as a "breaking change." Low risk since both implementations are in-tree.
- All other changes are additive (greenfield frontend, new endpoints).

### Test Impact
Every theme documents test strategy: Vitest for frontend components, pytest for backend, Playwright for E2E. Coverage thresholds documented. CI integration planned for each new test type.

---

## 12. Naming Convention Validation

### Theme Folders (pattern: `^\d{2}-[a-z][a-z0-9-]*[a-z0-9]$`)

| Folder | Matches? |
|--------|----------|
| `01-frontend-foundation` | PASS |
| `02-backend-services` | PASS |
| `03-gui-components` | PASS |
| `04-e2e-testing` | PASS |

### Feature Folders (pattern: `^\d{3}-[a-z][a-z0-9-]*[a-z0-9]$`)

| Folder | Matches? |
|--------|----------|
| `001-frontend-scaffolding` | PASS |
| `002-websocket-endpoint` | PASS |
| `003-settings-and-docs` | PASS |
| `001-thumbnail-pipeline` | PASS |
| `002-pagination-total-count` | PASS |
| `001-application-shell` | PASS |
| `002-dashboard-panel` | PASS |
| `003-library-browser` | PASS |
| `004-project-manager` | PASS |
| `001-playwright-setup` | PASS |
| `002-e2e-test-suite` | PASS |

### Double-Numbered Prefix Check (pattern: `\d{2,3}-\d{2,3}-`)

No matches found. All names use a single numeric prefix.

### THEME_INDEX Feature Lines (pattern: `^- \d{3}-[a-z][a-z0-9-]*[a-z0-9]: .+$`)

All 11 feature lines match the expected pattern.

---

## 13. Cross-Reference Consistency

### THEME_INDEX.md vs Folder Structure

| Source | Themes | Features |
|--------|--------|----------|
| THEME_INDEX.md | 4 | 11 |
| Disk folders | 4 | 11 |

**Theme comparison (case-sensitive):**

| Index Entry | Disk Folder | Match? |
|-------------|-------------|--------|
| `01-frontend-foundation` | `01-frontend-foundation` | EXACT |
| `02-backend-services` | `02-backend-services` | EXACT |
| `03-gui-components` | `03-gui-components` | EXACT |
| `04-e2e-testing` | `04-e2e-testing` | EXACT |

**Feature comparison (case-sensitive):**

All 11 features match exactly between THEME_INDEX.md entries and disk folder names. No orphan folders, no missing folders.
