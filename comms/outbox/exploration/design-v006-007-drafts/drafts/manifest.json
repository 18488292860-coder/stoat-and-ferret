{
  "version": "v006",
  "description": "Effects Engine Foundation — Build a greenfield Rust filter expression engine with graph validation, composition system, text overlay builder, speed control builders, effect discovery API, and clip effect application endpoint.",
  "backlog_ids": ["BL-037", "BL-038", "BL-039", "BL-040", "BL-041", "BL-042", "BL-043"],
  "context": {
    "rationale": "First version to enter Phase 2 (Effects & Composition), building on the complete Phase 1 foundation (v001-v005). Maps to roadmap milestones M2.1-M2.3.",
    "constraints": [
      "Independence from v005 — v006 is pure Rust + API work with no dependency on v005's GUI components",
      "PyO3 incremental binding rule — all new Rust types must include PyO3 bindings in the same feature",
      "Existing FFmpeg module is the integration point for new filter builders",
      "CI Rust coverage stays at 75% threshold — new code targets >90% individually",
      "No new external Rust dependencies (no petgraph, no proptest-derive)"
    ],
    "assumptions": [
      "Phase 1 foundation (v001-v005) is complete and stable",
      "FFmpeg 5.0+ is available in all environments",
      "Greenfield Rust work — no existing filter expression module to extend",
      "Dev databases are ephemeral — no migration framework needed for schema changes"
    ],
    "deferred_items": [
      "Rust coverage ratchet from 75% to 90% (separate post-v006 effort)",
      "Per-side boxborderw syntax (FFmpeg 5.0+ only)",
      "C4 architecture documentation update (tracked as BL-018)"
    ]
  },
  "themes": [
    {
      "number": 1,
      "slug": "filter-engine",
      "goal": "Build the foundational Rust filter infrastructure — expression type system, filter graph validation, and composition API.",
      "features": [
        {"number": 1, "slug": "expression-engine", "goal": "Type-safe Rust expression builder for FFmpeg filter expressions with proptest validation"},
        {"number": 2, "slug": "graph-validation", "goal": "Validate FilterGraph pad matching, detect unconnected pads and cycles using Kahn's algorithm"},
        {"number": 3, "slug": "filter-composition", "goal": "Programmatic chain, branch, and merge composition with automatic pad label management"}
      ]
    },
    {
      "number": 2,
      "slug": "filter-builders",
      "goal": "Implement concrete filter builders for text overlay and speed control using the expression engine from Theme 01.",
      "features": [
        {"number": 1, "slug": "drawtext-builder", "goal": "Type-safe drawtext filter builder with position presets, styling, and alpha animation via expression engine"},
        {"number": 2, "slug": "speed-builders", "goal": "setpts and atempo filter builders with automatic atempo chaining for speeds above 2.0x"}
      ]
    },
    {
      "number": 3,
      "slug": "effects-api",
      "goal": "Create the Python-side effect registry, discovery API endpoint, clip effect application endpoint, and update architecture documentation.",
      "features": [
        {"number": 1, "slug": "effect-discovery", "goal": "Effect registry with parameter schemas, AI hints, and GET /effects endpoint"},
        {"number": 2, "slug": "clip-effect-api", "goal": "POST endpoint to apply text overlay to clips with effect storage in clip model"},
        {"number": 3, "slug": "architecture-docs", "goal": "Update 02-architecture.md with new Rust modules, Effects Service, and clip model extension"}
      ]
    }
  ]
}
