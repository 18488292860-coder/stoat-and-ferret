# Impact Table — v008

| # | Area | Description | Classification | Resulting Work Item | Caused By |
|---|------|-------------|----------------|---------------------|-----------|
| 1 | docs/setup | `02_development-setup.md` Section 5 describes manual `alembic upgrade head` for DB init; after BL-058 this step becomes optional since startup auto-creates schema | small | Update Section 5 to note automatic schema creation at startup; keep Alembic commands as reference for migration management | BL-058 |
| 2 | docs/setup | `04_configuration.md` lines 26-27 document `STOAT_DEBUG` and `STOAT_LOG_LEVEL` but don't describe their runtime effect; after BL-056/BL-062 they will be actively consumed | small | Update Development section descriptions to reflect that these settings now control application behavior | BL-056, BL-062 |
| 3 | C4 docs | `c4-code-stoat-ferret-api.md` line 18 describes lifespan as "opens database, creates ConnectionManager, starts job worker"; after BL-056/BL-058 it also configures logging and creates schema | small | Update lifespan description to include logging configuration and schema creation steps | BL-056, BL-058 |
| 4 | C4 docs | `c4-code-python-api.md` line 19 describes lifespan as "opens DB, starts job worker, creates ConnectionManager"; same gap as #3 | small | Update lifespan summary to include logging and schema creation | BL-056, BL-058 |
| 5 | C4 docs | `c4-code-stoat-ferret-api.md` Mermaid diagram (lines 90-133) shows lifespan connecting to DB, job queue, worker, thumbnails, WS manager but not to logging or schema modules | small | Add logging and schema creation nodes to lifespan dependency diagram | BL-056, BL-058 |
| 6 | C4 docs | `c4-code-python-api.md` Mermaid diagram (lines 71-81) same gap — lifespan dependencies missing logging and schema | small | Add logging and schema creation edges to dependency diagram | BL-056, BL-058 |
| 7 | caller-impact | `src/stoat_ferret/api/__main__.py` line 27: `log_level="info"` hardcoded in `uvicorn.run()` — must be changed to use `settings.log_level.lower()` for BL-056 AC #5 | small | Wire `settings.log_level` to uvicorn's `log_level` parameter (sub-task of BL-056 implementation) | BL-056 |
| 8 | caller-impact | `configure_logging()` accepts `level: int` but `settings.log_level` is `Literal["DEBUG",...]` (string) — type conversion needed when wiring | small | Add `getattr(logging, settings.log_level)` conversion in lifespan call (sub-task of BL-056 implementation) | BL-056 |
| 9 | caller-impact | `create_tables()` is synchronous (`sqlite3.Connection`) but lifespan uses async `aiosqlite.Connection` — cannot call directly | small | Use `await conn.execute()` pattern (matching existing async test helpers) or `run_in_executor()` (sub-task of BL-058 implementation) | BL-058 |
| 10 | caller-impact | Three async test files duplicate `create_tables_async()` helper with manually-listed DDL statements; after BL-058 adds async schema creation to app.py, these become a fourth copy | substantial | Extract shared async `create_tables_async()` into `src/stoat_ferret/db/schema.py` and import in both app.py and test files | BL-058 |
| 11 | caller-impact | `ws.py` line 42 uses `DEFAULT_HEARTBEAT_INTERVAL` constant; wiring `settings.ws_heartbeat_interval` requires accessing settings inside the websocket endpoint | small | Replace constant with `get_settings().ws_heartbeat_interval` in websocket_endpoint (sub-task of BL-062 implementation) | BL-062 |
| 12 | caller-impact | `create_app()` at `app.py` line 119 instantiates `FastAPI()` without `debug=` kwarg; BL-062 AC #1 requires passing `settings.debug` | small | Add `debug=` kwarg to FastAPI constructor — requires settings access in `create_app()` (sub-task of BL-062 implementation) | BL-062 |
| 13 | caller-impact | Settings audit (BL-062 AC #3): after BL-056 wires `log_level` and BL-062 wires `debug` + `ws_heartbeat_interval`, all settings fields will be consumed — no residual orphans | small | Verify complete consumption in BL-062 acceptance testing (sub-task of BL-062 verification) | BL-062 |
| 14 | caller-impact | E2E test `project-creation.spec.ts` line 37 uses default 5-second Playwright timeout for `toBeHidden()` while other E2E tests use explicit 10-15s timeouts | small | Fix timing assertion — either add explicit timeout, use `waitForFunction`, or address underlying race condition (sub-task of BL-055 implementation) | BL-055 |
| 15 | test-compat | BL-056 activates logging output that was previously silent; test output will change and any tests asserting on stdout/stderr may break | small | Verify no tests capture stdout expecting silence; suppress or redirect logging in test fixtures if needed (sub-task of BL-056 verification) | BL-056 |
| 16 | test-compat | BL-058 adds `create_tables()` to lifespan; tests with `_deps_injected=True` skip lifespan so are unaffected, but any future integration test without the flag would get schema creation | small | Ensure test mode bypass (`_deps_injected`) continues to skip schema creation (sub-task of BL-058 verification) | BL-058 |
